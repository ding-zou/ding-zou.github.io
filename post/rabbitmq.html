<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">





  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "d1f94239"
    });
  daovoice('update');
  </script>














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/2.JPG?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/2.JPG?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Java Web,Java,消息中间件,RabbitMQ,消息队列,项目">





  <link rel="alternate" href="/atom.xml" title="Dzou's Blog" type="application/atom+xml">






<meta name="description" content="RabbitMQ—基于AMQP的消息队列.JMS即Java消息服务（Java Message Service）应用程序接口，是一个Java平台中关于面向消息中间件（MOM）的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。Java消息服务是一个与具体平台无关的API，绝大多数MOM提供商都对JMS提供支持。消息中间件：分布式系统中重要的组件，主要解决应用耦合，异步消息，流量削">
<meta name="keywords" content="Java Web,Java,消息中间件,RabbitMQ,消息队列,项目">
<meta property="og:type" content="article">
<meta property="og:title" content="RabbitMQ理解和使用">
<meta property="og:url" content="https://www.dzou.top/post/rabbitmq.html">
<meta property="og:site_name" content="Dzou&#39;s Blog">
<meta property="og:description" content="RabbitMQ—基于AMQP的消息队列.JMS即Java消息服务（Java Message Service）应用程序接口，是一个Java平台中关于面向消息中间件（MOM）的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。Java消息服务是一个与具体平台无关的API，绝大多数MOM提供商都对JMS提供支持。消息中间件：分布式系统中重要的组件，主要解决应用耦合，异步消息，流量削">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://dzou.wangminwei.top/static/images/rabbitmq/7.png">
<meta property="og:image" content="http://dzou.wangminwei.top/static/images/rabbitmq/8.png">
<meta property="og:image" content="http://dzou.wangminwei.top/static/images/rabbitmq/1.png">
<meta property="og:image" content="http://dzou.wangminwei.top/static/images/rabbitmq/2.png">
<meta property="og:image" content="http://dzou.wangminwei.top/static/images/rabbitmq/3.png">
<meta property="og:image" content="http://dzou.wangminwei.top/static/images/rabbitmq/4.png">
<meta property="og:image" content="http://dzou.wangminwei.top/static/images/rabbitmq/5.png">
<meta property="og:image" content="http://dzou.wangminwei.top/static/images/rabbitmq/6.png">
<meta property="og:updated_time" content="2019-09-12T11:55:20.436Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RabbitMQ理解和使用">
<meta name="twitter:description" content="RabbitMQ—基于AMQP的消息队列.JMS即Java消息服务（Java Message Service）应用程序接口，是一个Java平台中关于面向消息中间件（MOM）的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。Java消息服务是一个与具体平台无关的API，绝大多数MOM提供商都对JMS提供支持。消息中间件：分布式系统中重要的组件，主要解决应用耦合，异步消息，流量削">
<meta name="twitter:image" content="http://dzou.wangminwei.top/static/images/rabbitmq/7.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'Q66404JRFM',
      apiKey: '27dd0e53d330bf96c9826662fc30055a',
      indexName: 'dzou',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://www.dzou.top/post/rabbitmq.html">





<link href="/js/google-code-prettify/tomorrow-night-eighties.min.css" type="text/css" rel="stylesheet">



  <title>RabbitMQ理解和使用 | Dzou's Blog</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  
  
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="bg_content">
    <canvas id="canvas"></canvas>
  </div>

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Dzou's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">No pains,no gains.</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.dzou.top/post/rabbitmq.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzou">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/2.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dzou's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">RabbitMQ理解和使用</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-11T19:55:55+08:00">
                2019-09-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/消息中间件/" itemprop="url" rel="index">
                    <span itemprop="name">消息中间件</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/post/rabbitmq.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="post/rabbitmq.html" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>&nbsp浏览次数：
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次
            </span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  4k字
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  16分
                </span>
              
            </div>
          

          
              <div class="post-description">
                  RabbitMQ—基于AMQP的消息队列.JMS即Java消息服务（Java Message Service）应用程序接口，是一个Java平台中关于面向消息中间件（MOM）的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。Java消息服务是一个与具体平台无关的API，绝大多数MOM提供商都对JMS提供支持。消息中间件：分布式系统中重要的组件，主要解决应用耦合，异步消息，流量削锋等问题。
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>##　JMS—Java消息服务</p>
<blockquote>
<p>JMS即Java消息服务（Java Message Service）应用程序接口，是一个Java平台中关于面向消息中间件（MOM）的API，用于在两个应用程序之间，或分布式系统中发送消息，进行异步通信。Java消息服务是一个与具体平台无关的API，绝大多数MOM提供商都对JMS提供支持。</p>
</blockquote>
<p><strong>RabbitMQ客户端、ActiveMQ、Kafka、RocketMQ等都有使用JMS API实现</strong></p>
<p><strong>异步：</strong>订阅者或消费者可以注册为一个消息监听器。当消息到达之后，系统自动调用监听器的onMessage方法。</p>
<p><strong>同步：</strong>订阅者或消费者调用receive方法来接收消息，receive方法在能够接收到消息之前（或超时之前）将一直阻塞</p>
<h3 id="消息模型"><a href="#消息模型" class="headerlink" title="消息模型"></a>消息模型</h3><h4 id="点对点"><a href="#点对点" class="headerlink" title="点对点"></a>点对点</h4><p>每个消息都被发送到一个特定的队列，接收者从队列中获取消息。队列保留着消息，直到他们被消费或超时。</p>
<img src="http://dzou.wangminwei.top/static/images/rabbitmq/7.png">

<h4 id="发布者-订阅者-Pub-Sub"><a href="#发布者-订阅者-Pub-Sub" class="headerlink" title="发布者/订阅者(Pub/Sub)"></a>发布者/订阅者(Pub/Sub)</h4><p>多个发布者将消息发送到Topic,系统将这些消息传递给多个订阅者。</p>
<img src="http://dzou.wangminwei.top/static/images/rabbitmq/8.png">

<h2 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h2><p>消息（Message）是指在应用间传送的数据。消息可以非常简单，比如只包含文本字符串，也可以更复杂，可能包含嵌入对象。</p>
<p>消息队列（Message Queue）是一种应用间的通信方式，消息发送后可以立即返回，由消息系统来确保消息的可靠传递。消息发布者只管把消息发布到 MQ 中而不用管谁来取，消息使用者只管从 MQ 中取消息而不管是谁发布的。这样发布者和使用者都不用知道对方的存在。</p>
<blockquote>
<p>从上面的描述中可以看出消息队列是一种应用间的异步协作机制，那什么时候需要使用 MQ 呢？</p>
<p>以常见的订单系统为例，用户点击【下单】按钮之后的业务逻辑可能包括：扣减库存、生成相应单据、发红包、发短信通知。在业务发展初期这些逻辑可能放在一起同步执行，随着业务的发展订单量增长，需要提升系统服务的性能，这时可以将一些不需要立即生效的操作拆分出来异步执行，比如发放红包、发短信通知等。这种场景下就可以用 MQ ，在下单的主流程（比如扣减库存、生成相应单据）完成之后发送一条消息到 MQ 让主流程快速完结，而由另外的单独线程拉取MQ的消息（或者由 MQ 推送消息），当发现 MQ 中有发红包或发短信之类的消息时，执行相应的业务逻辑。</p>
<p>以上是用于业务解耦的情况，其它常见场景包括最终一致性、广播、错峰流控等等。</p>
</blockquote>
<ul>
<li>秒杀业务：把扣减库存服务和生成订单服务拆分</li>
<li>用户注册后发送邮件和短信，无需等待发送，只需提交给RabbitMQ队列异步处理</li>
</ul>
<h2 id="RabbitMQ—基于AMQP的消息队列"><a href="#RabbitMQ—基于AMQP的消息队列" class="headerlink" title="RabbitMQ—基于AMQP的消息队列"></a>RabbitMQ—基于AMQP的消息队列</h2><blockquote>
<p>使用<code>ErLang</code>编写，使用<code>JMS API</code>集成,但是RabbitMQ路由过程除了消息、发送者、接受者还有<code>交换机</code>和<code>绑定者</code>的角色，决定发送到那个队列</p>
</blockquote>
<p><strong>消息中间件：分布式系统中重要的组件，主要解决应用耦合，异步消息，流量削锋等问题。</strong></p>
<ul>
<li>异步处理</li>
<li>应用解耦(订单服务和库存服务)</li>
<li>流量削峰</li>
<li>不需要及时得到结果的消息放到MQ中</li>
</ul>
<img src="http://dzou.wangminwei.top/static/images/rabbitmq/1.png">

<ol>
<li>Exchange 交换器，用来接收生产者发送的消息并将这些消息路由给服务器中的队列。</li>
<li>Binding 绑定，用于消息队列和交换器之间的关联。一个绑定就是基于路由键将交换器和消息队列连接起来的路由规则，所以可以将交换器理解成一个由绑定构成的路由表。</li>
<li>Channel 信道，多路复用连接中的一条独立的双向数据流通道。信道是建立在真实的TCP连接内地虚拟连接，AMQP 命令都是通过信道发出去的，不管是发布消息、订阅队列还是接收消息，这些动作都是通过信道完成。因为对于操作系统来说建立和销毁 TCP 都是非常昂贵的开销，所以引入了信道的概念，以复用一条 TCP 连接。</li>
<li>Virtual Host 虚拟主机，表示一批交换器、消息队列和相关对象。虚拟主机是共享相同的身份认证和加密环境的独立服务器域。每个 vhost 本质上就是一个 mini 版的 RabbitMQ 服务器，拥有自己的队列、交换器、绑定和权限机制。vhost 是 AMQP 概念的基础，必须在连接时指定，RabbitMQ 默认的 vhost 是 / 。</li>
<li>Broker 表示消息队列服务器实体。</li>
</ol>
<img src="http://dzou.wangminwei.top/static/images/rabbitmq/2.png">

<h3 id="Exchange类型"><a href="#Exchange类型" class="headerlink" title="Exchange类型"></a>Exchange类型</h3><h4 id="Direct"><a href="#Direct" class="headerlink" title="Direct"></a>Direct</h4><p><strong>消息中的路由键（routing key）如果和 Binding 中的 binding key 一致， 交换器就将消息发到对应的队列中。路由键与队列名完全匹配，如果一个队列绑定到交换机要求路由键为“dog”，则只转发 routing key 标记为“dog”的消息，不会转发“dog.puppy”，也不会转发“dog.guard”等等。它是完全匹配、单播的模式.</strong></p>
<img src="http://dzou.wangminwei.top/static/images/rabbitmq/3.png">

<h4 id="Fanout"><a href="#Fanout" class="headerlink" title="Fanout"></a>Fanout</h4><p><strong>每个发到 fanout 类型交换器的消息都会分到所有绑定的队列上去。fanout 交换器不处理路由键，只是简单的将队列绑定到交换器上，每个发送到交换器的消息都会被转发到与该交换器绑定的所有队列上。</strong></p>
<img src="http://dzou.wangminwei.top/static/images/rabbitmq/4.png">

<h4 id="Topic"><a href="#Topic" class="headerlink" title="Topic"></a>Topic</h4><p><strong>将路由键和某个模式进行匹配，此时队列需要绑定到一个模式上。它将路由键和绑定键的字符串切分成单词，这些单词之间用点隔开。#匹配0个或多个单词，*匹配不多不少一个单词。</strong></p>
<img src="http://dzou.wangminwei.top/static/images/rabbitmq/5.png">

<h3 id="常用命令行操作"><a href="#常用命令行操作" class="headerlink" title="常用命令行操作"></a>常用命令行操作</h3><ul>
<li><p><code>sudo rabbitmq-server</code>  启动RabbitMQ</p>
</li>
<li><p><code>systemctl status rabbitmq-server.service</code> 查看RabbitMQ状态</p>
</li>
<li><p><code>sudo systemctl restart rabbitmq-server</code> 重启RabbitMQ</p>
</li>
<li><p><code>sudo rabbitmq-plugins enable rabbitmq_management</code> 启用 RabbitMQ web 管理插件 可以在 <code>15672</code>端口进入RabbitMQ后台</p>
</li>
<li><p><code>sudo rabbitmqctl stop</code> 停止RabbitMQ(关闭整个节点)</p>
</li>
<li><p><code>sudo rabbitmqctl stop_app</code> 只关闭应用程序不关闭节点 </p>
</li>
<li><p><code>sudo rabbitmqctl start_app</code>启动应用程序</p>
</li>
<li><p><code>sudo rabbitmqctl list_queues</code> 查看RabbitMQ中的队列</p>
</li>
<li><p><code>sudo rabbitmqctl list_exchanges</code>查看交换器</p>
</li>
<li><p><code>sudo rabbitmqctl list_bindings</code>查看绑定</p>
</li>
<li><p><code>sudo rabbitmqctl reset</code> 重置RabbitMQ节点(清空队列)，但是在使用此命令前，要先关闭应用，否则不能清除</p>
</li>
<li><p><code>sudo rabbitmqctl add_user  dzou 1234</code> 添加用户</p>
</li>
</ul>
<h3 id="rabbitmq-client"><a href="#rabbitmq-client" class="headerlink" title="rabbitmq-client"></a>rabbitmq-client</h3><ul>
<li>maven依赖</li>
</ul>
<pre><code class="xml">        &lt;dependency&gt;
            &lt;groupId&gt;com.rabbitmq&lt;/groupId&gt;
            &lt;artifactId&gt;amqp-client&lt;/artifactId&gt;
            &lt;version&gt;3.6.0&lt;/version&gt;
        &lt;/dependency&gt;</code></pre>
<ul>
<li>发送者</li>
</ul>
<pre><code class="java">public class P {

  private final static String QUEUE_NAME = &quot;hello&quot;;

  public static void main(String[] argv) throws Exception {
    ConnectionFactory factory = new ConnectionFactory();
    factory.setHost(&quot;localhost&quot;);
    Connection connection = factory.newConnection();
    Channel channel = connection.createChannel();

    channel.queueDeclare(QUEUE_NAME, false, false, false, null);
    String message = &quot;Hello World!&quot;;
    channel.basicPublish(&quot;&quot;, QUEUE_NAME, null, message.getBytes(&quot;UTF-8&quot;));
    System.out.println(&quot;P [x] Sent &#39;&quot; + message + &quot;&#39;&quot;);

    channel.close();
    connection.close();
  }
}</code></pre>
<ul>
<li>接收者</li>
</ul>
<pre><code class="java">public class C {

    private final static String QUEUE_NAME = &quot;hello&quot;;

    public static void main(String[] argv) throws Exception {
        ConnectionFactory factory = new ConnectionFactory();
        factory.setHost(&quot;localhost&quot;);
        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();

        channel.queueDeclare(QUEUE_NAME, false, false, false, null);
        System.out.println(&quot;C [*] Waiting for messages. To exit press CTRL+C&quot;);

        Consumer consumer = new DefaultConsumer(channel) {
            @Override
            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, byte[] body) throws IOException {
                String message = new String(body, &quot;UTF-8&quot;);
                System.out.println(&quot;C [x] Received &#39;&quot; + message + &quot;&#39;&quot;);
            }
        };
        channel.basicConsume(QUEUE_NAME, true, consumer);
    }
}</code></pre>
<h3 id="AmqpTemplate"><a href="#AmqpTemplate" class="headerlink" title="AmqpTemplate"></a>AmqpTemplate</h3><h5 id="Maven依赖"><a href="#Maven依赖" class="headerlink" title="Maven依赖"></a>Maven依赖</h5><pre><code class="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
<h5 id="yml配置"><a href="#yml配置" class="headerlink" title="yml配置"></a>yml配置</h5><pre><code class="yml">spring:
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest
    virtual-host: /
    listener:
      simple:
        acknowledge-mode: manual # 手动应答
        concurrency: 5 # 消费端最小并发数
        max-concurrency: 10 # 消费端最大并发数
        prefetch: 5 # 一次请求中预处理的消息数量
    cache:
      channel:
        size: 50 # 缓存的channel数量
### 自定义配置 可不需要
mq:
  defaultExchange: amqpExchange # 默认交换器
  queue: queue # 队列名
  routeKey: queue_key # 路由key</code></pre>
<h5 id="配置MQ队列"><a href="#配置MQ队列" class="headerlink" title="配置MQ队列"></a>配置MQ队列</h5><pre><code class="java">@Configuration
public class MQConfig {

    public static final String SECKILL_QUEUE = &quot;seckill.queue&quot;;

    @Bean
    public Queue secKillQueue(){
        return new Queue(SECKILL_QUEUE);
    }
}</code></pre>
<h5 id="发送者"><a href="#发送者" class="headerlink" title="发送者"></a>发送者</h5><pre><code class="java">@Service
@Slf4j
public class MQSender {

    @Autowired
    private AmqpTemplate amqpTemplate;
    @Autowired
    RedisService redisService;

    public void sendSeckillInfo(SecKillMessage secKillMessage) {
        String msg = redisService.beanToString(secKillMessage);
        log.info(&quot;send message :{}&quot;,msg);
        amqpTemplate.convertAndSend(MQConfig.SECKILL_QUEUE,msg);
    }

    public void send(Object message){
        String msg = redisService.beanToString(message);
        log.info(&quot;send message :{}&quot;,msg);
        amqpTemplate.convertAndSend(MQConfig.QUEUE_NAME,msg);
    }
    //以Topic模式发送
    public void sendTopic(Object message){
        String msg = redisService.beanToString(message);
        log.info(&quot;send message :{}&quot;,msg);
        amqpTemplate.convertAndSend(MQConfig.TOPIC_EXCHANGE_NAME,MQConfig.ROUTING_KEY1_NAME,msg);
        amqpTemplate.convertAndSend(MQConfig.TOPIC_EXCHANGE_NAME,MQConfig.ROUTING_KEY_NAME,msg+&quot;17231&quot;);
    }
    //以fanout模式发送
    public void sendFanout(Object message) {
        String msg = redisService.beanToString(message);
        log.info(&quot;send fanout message:&quot;+msg);
        amqpTemplate.convertAndSend(MQConfig.FANOUT_EXCHANGE_NAME, &quot;&quot;, msg);
    }
    //以Header模式发送
    public void sendHeader(Object message) throws UnsupportedEncodingException {
        String msg = redisService.beanToString(message);
        log.info(&quot;send header message:&quot; + msg);
        MessageProperties properties = new MessageProperties();
        properties.setHeader(&quot;header1&quot;, &quot;value1&quot;);
        properties.setHeader(&quot;header2&quot;, &quot;value2&quot;);
        Message obj = new Message(msg.getBytes(&quot;UTF-8&quot;), properties);
        amqpTemplate.convertAndSend(MQConfig.HEADERS_EXCHANGE_NAME, &quot;&quot;, obj);
    }
}</code></pre>
<h5 id="接收者"><a href="#接收者" class="headerlink" title="接收者"></a>接收者</h5><pre><code class="java">@Slf4j
@Service
@RabbitListener(queues = MQConfig.SECKILL_QUEUE)
public class MQReceive {

    @Autowired
    private RedisService redisService;
    @Autowired
    private SecKillService secKillService;

    @RabbitHandler
    public void receiveMsg(String message){
        log.info(&quot;receive msg:{}&quot;,message);
        SecKillMessage msg = redisService.stringToBean(message,SecKillMessage.class);
            //处理相应的业务逻辑
    }
    //测试Topic模式
    @RabbitListener(queues = MQConfig.TOPIC_QUEUE1_NAME)
    public void receiveMsg(String message){
        log.info(&quot;receive msg:{}&quot;,message);
    }
    @RabbitListener(queues = MQConfig.TOPIC_QUEUE2_NAME)
    public void receiveMsg2(String message){
        log.info(&quot;receive msg:{}&quot;,message);
    }
    //测试Headers模式
    @RabbitListener(queues=MQConfig.HEADERS_QUEUE2_NAME)
    public void receiveHeaderQueue(byte[] message) throws UnsupportedEncodingException {
        log.info(&quot; header  queue message:&quot;+new String(message,&quot;UTF-8&quot;));
    }
}</code></pre>
<h5 id="String和Bean互转"><a href="#String和Bean互转" class="headerlink" title="String和Bean互转"></a>String和Bean互转</h5><blockquote>
<p>使用alibaba的<code>fastJson</code></p>
</blockquote>
<pre><code class="java">//bean转为字符串
    public  &lt;T&gt; String beanToString(T value) {
        if (value == null) {
            return null;
        }
        Class&lt;?&gt; clazz = value.getClass();
        if (clazz == int.class || clazz == Integer.class) {
            return &quot;&quot; + value;
        } else if (clazz == String.class) {
            return (String) value;
        } else if (clazz == long.class || clazz == Long.class) {
            return &quot;&quot; + value;
        } else {
            return JSON.toJSONString(value);
        }
    }

    //字符串转为bean
    @SuppressWarnings(&quot;unchecked&quot;)
    public  &lt;T&gt; T stringToBean(String str, Class&lt;T&gt; clazz) {
        if (str == null || str.length() &lt;= 0 || clazz == null) {
            return null;
        }
        if (clazz == int.class || clazz == Integer.class) {
            return (T) Integer.valueOf(str);
        } else if (clazz == String.class) {
            return (T) str;
        } else if (clazz == long.class || clazz == Long.class) {
            return (T) Long.valueOf(str);
        } else {
            return JSON.parseObject(str, clazz);
        }
    }</code></pre>
<blockquote>
<p>RabbitMQ支持集群分发消息</p>
</blockquote>
<h3 id="工作队列"><a href="#工作队列" class="headerlink" title="工作队列"></a>工作队列</h3><p>将任务封装为消息并发给队列。在后台运行的工作者（consumer）将其取出，然后最终执行。当你运行多个工作者（consumer），队列中的任务被工作进行共享执行。</p>
<h3 id="轮询分发"><a href="#轮询分发" class="headerlink" title="轮询分发"></a>轮询分发</h3><p>一个生产者生产消息到队列，多个消费者从队列依次轮询消费消息。这里的轮询机制是你一个，我一个轮询分发机制，比如我有50个消息，无论C1、C2的消费处理能力如何，最后他们都会按照你一个我一个的方式都拿到25个消息消费，这就是所谓的轮询，轮着来的意思。</p>
<h3 id="消息应答和持久化—针对消费者"><a href="#消息应答和持久化—针对消费者" class="headerlink" title="消息应答和持久化—针对消费者"></a>消息应答和持久化—针对消费者</h3><h4 id="消息应答—ACK"><a href="#消息应答—ACK" class="headerlink" title="消息应答—ACK"></a>消息应答—ACK</h4><blockquote>
<p>默认情况下如果一个 Message 被消费者所正确接收则会被从 Queue 中移除</p>
</blockquote>
<blockquote>
<p>如果一个 Queue 没被任何消费者订阅，那么这个 Queue 中的消息会被 Cache（缓存），当有消费者订阅时则会立即发送，当 Message 被消费者正确接收时，就会被从 Queue 中移除</p>
</blockquote>
<p><strong>Message acknowledgment(消息应答)：当消息被消费者成功接收到时，就会告诉RabbitMQ你可以从队列删除该消息，我已经接收到了</strong></p>
<pre><code class="java">autoAck = true;//自动确认模式，当消息被接收，就从内存中删除</code></pre>
<p><strong>这种情况下，杀死消费者就会导致消息丢失。</strong></p>
<pre><code class="java">autoAck = false;//手动确认模式，如果有消息挂了，就把该消息交给其他消费者</code></pre>
<p><strong>这种情况下，消费者挂了不会丢失消息，但是如果服务器宕机RabbitMQ挂了，消息也会丢失。</strong></p>
<blockquote>
<p>所以我们需要使用其他机制把消息存储起来。</p>
</blockquote>
<h4 id="持久化—durable"><a href="#持久化—durable" class="headerlink" title="持久化—durable"></a>持久化—durable</h4><ul>
<li>声明好的队列无法更改持久化</li>
</ul>
<p><strong>默认队列和消息都是放在内存中的，当RabbitMQ退出或者崩溃，将会丢失队列和消息。为了保证即使RabbitMQ崩溃也不会丢失消息，我们必须把“队列”和“消息”设为持久化，当队列和消息持久化以后即使RabbitMQ崩溃，消息还存在磁盘中，当RabbitMQ再次启动的时候，队列和消息仍然还在。</strong></p>
<ul>
<li><strong>durable</strong>设置为true</li>
</ul>
<pre><code class="java">// 队列持久化
boolean durable = true;  
channel.queueDeclare(&quot;hello&quot;, durable, false, false, null); 

// 消息持久化 方式一
channel.basicPublish(&quot;&quot;, &quot;key&quot;, MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes(&quot;UTF-8&quot;));

// 消息持久化 方式二
AMQP.BasicProperties.Builder properties = new AMQP.BasicProperties().builder();
properties.deliveryMode(2);  // 设置消息是否持久化，1： 非持久化 2：持久化
channel.basicPublish(&quot;&quot;, &quot;key&quot;, properties.build(), message.getBytes(&quot;UTF-8&quot;));</code></pre>
<p><strong>但是消息任然可以没有保存到内存中，如果要完全100%保证写入RabbitMQ的数据必须落地磁盘，不会丢失，需要依靠其他的机制。</strong></p>
<h3 id="消息确认机制—针对生产者"><a href="#消息确认机制—针对生产者" class="headerlink" title="消息确认机制—针对生产者"></a>消息确认机制—针对生产者</h3><p><strong>当消息的发布者在将消息发送出去之后，消息到底有没有正确到达broker代理服务器呢？</strong></p>
<blockquote>
<p>如果到不了，那么持久化将无法使用，为此，我们还需要对生产者发送消息建立确认机制</p>
</blockquote>
<p>RabbitMQ提供两种消息确认机制：</p>
<ul>
<li>事务：通过AMQP事务机制实现</li>
<li>confirm：通过将channel设置成confirm模式来实现</li>
</ul>
<h4 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h4><p><strong>RabbitMQ中与事务机制有关的方法有三个：txSelect(), txCommit()以及txRollback(), txSelect用于将当前channel设置成transaction模式，txCommit用于提交事务，txRollback用于回滚事务，在通过txSelect开启事务之后，我们便可以发布消息给broker代理服务器了，如果txCommit提交成功了，则消息一定到达了broker了，如果在txCommit执行之前broker异常崩溃或者由于其他原因抛出异常，这个时候我们便可以捕获异常通过txRollback回滚事务了。</strong></p>
<pre><code class="java">
channel.txSelect();//开启事务模式
channel.basicPublish(ConfirmConfig.exchangeName, ConfirmConfig.routingKey, MessageProperties.PERSISTENT_TEXT_PLAIN, ConfirmConfig.msg_10B.getBytes());
channel.txCommit();
</code></pre>
<blockquote>
<p>只有消息成功被服务器接受，事务提交才能成功，否则我们便可以在捕获异常进行事务回滚操作同时进行消息重发，但是使用事务机制的话会降低RabbitMQ的性能,<code>下面我们还用一种更高效的方法确认消息的提交：confirm</code></p>
</blockquote>
<h4 id="confirm"><a href="#confirm" class="headerlink" title="confirm"></a>confirm</h4><p><strong>消息的确认是指生产者投递消息后，如果 Broker 代理服务器接收到消息，则会给生产者一个应答(根据一个指定的唯一id确认消息)。生产者进行接收应答，用来确认这条消息是否正常的发送到 Broker，这种方式也是消息可靠性投递的核心保障</strong></p>
<img src="http://dzou.wangminwei.top/static/images/rabbitmq/6.png">

<ul>
<li>设置为confirm模式</li>
</ul>
<pre><code class="java">channel.confirmSelect();</code></pre>
<h5 id="confirm模式有三种："><a href="#confirm模式有三种：" class="headerlink" title="confirm模式有三种："></a>confirm模式有三种：</h5><ul>
<li>普通confirm模式：每发送一条消息后，调用<code>waitForConfirms()</code>方法，等待服务器端confirm。实际上是一种串行confirm。</li>
</ul>
<pre><code class="java">channel.basicPublish(ConfirmConfig.exchangeName, ConfirmConfig.routingKey, MessageProperties.PERSISTENT_TEXT_PLAIN, ConfirmConfig.msg_10B.getBytes());
if(!channel.waitForConfirms()){
    System.out.println(&quot;send message failed.&quot;);
}</code></pre>
<ul>
<li>批量confirm模式：每发送一批消息后，调用<code>waitForConfirms()</code>方法，等待服务器端confirm。</li>
</ul>
<pre><code class="java">channel.confirmSelect();
for(int i=0;i&lt;batchCount;i++){
    channel.basicPublish(ConfirmConfig.exchangeName, ConfirmConfig.routingKey, MessageProperties.PERSISTENT_TEXT_PLAIN, ConfirmConfig.msg_10B.getBytes());
}
if(!channel.waitForConfirms()){
    System.out.println(&quot;send message failed.&quot;);
}</code></pre>
<blockquote>
<p>其中一个消息返回false需要消息全部重发</p>
</blockquote>
<ul>
<li>异步confirm模式：提供一个回调方法(监听器)，服务端confirm了一条或者多条消息后Client端会回调这个方法。</li>
</ul>
<pre><code class="java"> channel.confirmSelect();
        channel.addConfirmListener(new ConfirmListener() {
            //发送成功
            public void handleAck(long deliveryTag, boolean multiple) throws IOException {
                //成功进入这，根据业务实现
            }
            //发送失败
            public void handleNack(long deliveryTag, boolean multiple) throws IOException {
                System.out.println(&quot;Nack, SeqNo: &quot; + deliveryTag + &quot;, multiple: &quot; + multiple);
                //失败进入这，根据业务实现
            }
        });

        while (true) {
            long nextSeqNo = channel.getNextPublishSeqNo();
            channel.basicPublish(ConfirmConfig.exchangeName, ConfirmConfig.routingKey, MessageProperties.PERSISTENT_TEXT_PLAIN, ConfirmConfig.msg_10B.getBytes());
            confirmSet.add(nextSeqNo);
        }</code></pre>
<p>参考博文：</p>
<p><a href="https://juejin.im/post/5a67f7836fb9a01cb74e8931" rel="external nofollow noopener noreferrer" target="_blank">https://juejin.im/post/5a67f7836fb9a01cb74e8931</a></p>
<p><a href="https://segmentfault.com/a/1190000017130224" rel="external nofollow noopener noreferrer" target="_blank">https://segmentfault.com/a/1190000017130224</a></p>
<p>安装参考：</p>
<p><a href="https://blog.csdn.net/nextyu/article/details/79250174#commentBox" rel="external nofollow noopener noreferrer" target="_blank">https://blog.csdn.net/nextyu/article/details/79250174#commentBox</a></p>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    dzou  |  微信：17856530567
  </li>
  <li class="post-copyright-link">
  <strong>本文链接：</strong>
  <a href="http://www.dzou.top/post/rabbitmq.html" title="RabbitMQ理解和使用">http://www.dzou.top/post/rabbitmq.html</a>
</li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noopener noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！
  </li>
  <li class="post-copyright-license">
    并保留本声明和上方二维码。感谢您的阅读和支持！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/Web/" rel="tag"># Web</a>
          
            <a href="/tags/项目/" rel="tag"># 项目</a>
          
            <a href="/tags/消息队列/" rel="tag"># 消息队列</a>
          
            <a href="/tags/JMS/" rel="tag"># JMS</a>
          
            <a href="/tags/消息中间件/" rel="tag"># 消息中间件</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div id="needsharebutton-postbottom">
            <span class="btn">
              <i class="fa fa-share-alt" aria-hidden="true"></i>
            </span>
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/post/read-config-springboot.html" rel="next" title="SpringBoot读取配置文件的方法">
                <i class="fa fa-chevron-left"></i> SpringBoot读取配置文件的方法
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/post/seckill-sum.html" rel="prev" title="秒杀Seckill项目总结">
                秒杀Seckill项目总结 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript" rel="external nofollow noopener noreferrer" target="_blank">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/2.JPG" alt="dzou">
            
              <p class="site-author-name" itemprop="name">dzou</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">70</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">10</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">75</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/ding-zou" target="_blank" title="GitHub" rel="external nofollow noopener noreferrer">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="dingxiang.zoufubo@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://me.csdn.net/qq_44760332" target="_blank" title="CSDN" rel="external nofollow noopener noreferrer">
                      
                        <i class="fa fa-fw fa-copyright"></i>CSDN</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                推荐链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.dzou.top/post/7a5625fe.html" title="Java并发之AQS源码分析" target="_blank">Java并发之AQS源码分析</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.dzou.top/post/366ffd58.html" title="SpringBoot自动配置原理-源码分析" target="_blank">SpringBoot自动配置原理-源码分析</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.dzou.top/post/712f837.html" title="Java Web安全框架Shiro使用" target="_blank">Java Web安全框架Shiro使用</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.dzou.top/post/19e1cc75.html" title="Linux基础命令" target="_blank">Linux基础命令</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.dzou.top/post/8184a8fd.html" title="JDK8新特性——流和Lambda表达式" target="_blank">JDK8新特性——流和Lambda表达式</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://music.163.com/#/user/home?id=564117665" title="网易云音乐" target="_blank" rel="external nofollow noopener noreferrer">网易云音乐</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#消息模型"><span class="nav-number">1.</span> <span class="nav-text">消息模型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#点对点"><span class="nav-number">1.1.</span> <span class="nav-text">点对点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#发布者-订阅者-Pub-Sub"><span class="nav-number">1.2.</span> <span class="nav-text">发布者/订阅者(Pub/Sub)</span></a></li></ol></li></ol><li class="nav-item nav-level-2"><a class="nav-link" href="#消息队列"><span class="nav-number"></span> <span class="nav-text">消息队列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RabbitMQ—基于AMQP的消息队列"><span class="nav-number"></span> <span class="nav-text">RabbitMQ—基于AMQP的消息队列</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Exchange类型"><span class="nav-number">1.</span> <span class="nav-text">Exchange类型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Direct"><span class="nav-number">1.1.</span> <span class="nav-text">Direct</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Fanout"><span class="nav-number">1.2.</span> <span class="nav-text">Fanout</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Topic"><span class="nav-number">1.3.</span> <span class="nav-text">Topic</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#常用命令行操作"><span class="nav-number">2.</span> <span class="nav-text">常用命令行操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rabbitmq-client"><span class="nav-number">3.</span> <span class="nav-text">rabbitmq-client</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AmqpTemplate"><span class="nav-number">4.</span> <span class="nav-text">AmqpTemplate</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Maven依赖"><span class="nav-number">4.0.1.</span> <span class="nav-text">Maven依赖</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#yml配置"><span class="nav-number">4.0.2.</span> <span class="nav-text">yml配置</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#配置MQ队列"><span class="nav-number">4.0.3.</span> <span class="nav-text">配置MQ队列</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#发送者"><span class="nav-number">4.0.4.</span> <span class="nav-text">发送者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#接收者"><span class="nav-number">4.0.5.</span> <span class="nav-text">接收者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#String和Bean互转"><span class="nav-number">4.0.6.</span> <span class="nav-text">String和Bean互转</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#工作队列"><span class="nav-number">5.</span> <span class="nav-text">工作队列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#轮询分发"><span class="nav-number">6.</span> <span class="nav-text">轮询分发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#消息应答和持久化—针对消费者"><span class="nav-number">7.</span> <span class="nav-text">消息应答和持久化—针对消费者</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#消息应答—ACK"><span class="nav-number">7.1.</span> <span class="nav-text">消息应答—ACK</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#持久化—durable"><span class="nav-number">7.2.</span> <span class="nav-text">持久化—durable</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#消息确认机制—针对生产者"><span class="nav-number">8.</span> <span class="nav-text">消息确认机制—针对生产者</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#事务"><span class="nav-number">8.1.</span> <span class="nav-text">事务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#confirm"><span class="nav-number">8.2.</span> <span class="nav-text">confirm</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#confirm模式有三种："><span class="nav-number">8.2.1.</span> <span class="nav-text">confirm模式有三种：</span></a></li></ol></li></ol></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dzou</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">96.8k</span>
  
</div>









        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问用户：
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 访问次数：
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://dzou.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://www.dzou.top/post/rabbitmq.html';
          this.page.identifier = 'post/rabbitmq.html';
          this.page.title = 'RabbitMQ理解和使用';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://dzou.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=5.1.4"></script>



  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "topCenter";
      
          pbOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
      flOptions = {};
      
          flOptions.iconStyle = "box";
      
          flOptions.boxForm = "horizontal";
      
          flOptions.position = "topRight";
      
          flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

  

  

  

  


</body>
</html>
<script type="text/javascript" src="/js/src/dynamic_bg.js"></script>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>
<script type="text/javascript" src="/js/google-code-prettify/prettify.js"></script>
<script type="text/javascript">
$(window).load(function(){
   $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
   prettyPrint();
 })    
</script>

